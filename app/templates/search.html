{% extends "base.html" %}

{% block title %}Search Jobs - Job Search{% endblock %}

{% block content %}
<section class="search-page">
    <h1>Search Jobs</h1>
    <p class="page-subtitle">Find your next opportunity from thousands of listings</p>
    
    <form action="{{ url_for('jobs.search') }}" method="get" class="search-form" id="searchForm">
        <div class="form-row">
            <div class="form-group">
                <label for="query">Keywords</label>
                <input type="text" id="query" name="query" value="{{ query }}" placeholder="Job title, skills, or company" required>
            </div>
            
            <div class="form-group">
                <label for="location">Location</label>
                <input type="text" id="location" name="location" value="{{ location }}" placeholder="City, state, or country">
            </div>
        </div>
        
        <div class="form-row filters">
            <div class="form-group">
                <label for="date_posted">Date Posted</label>
                <select id="date_posted" name="date_posted">
                    <option value="all" {% if date_posted == 'all' %}selected{% endif %}>All Time</option>
                    <option value="today" {% if date_posted == 'today' %}selected{% endif %}>Today</option>
                    <option value="3days" {% if date_posted == '3days' %}selected{% endif %}>Last 3 Days</option>
                    <option value="week" {% if date_posted == 'week' %}selected{% endif %}>Last Week</option>
                    <option value="month" {% if date_posted == 'month' %}selected{% endif %}>Last Month</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="employment_type">Employment Type</label>
                <select id="employment_type" name="employment_type">
                    <option value="" {% if not employment_type %}selected{% endif %}>All Types</option>
                    <option value="FULLTIME" {% if employment_type == 'FULLTIME' %}selected{% endif %}>Full Time</option>
                    <option value="PARTTIME" {% if employment_type == 'PARTTIME' %}selected{% endif %}>Part Time</option>
                    <option value="CONTRACTOR" {% if employment_type == 'CONTRACTOR' %}selected{% endif %}>Contract</option>
                    <option value="INTERN" {% if employment_type == 'INTERN' %}selected{% endif %}>Internship</option>
                </select>
            </div>
            
            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="remote_only" value="true" {% if remote_only %}checked{% endif %}>
                    Remote Jobs Only
                </label>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
            Search Jobs
        </button>
    </form>
    
    {% if error %}
    <div class="alert alert-error">{{ error }}</div>
    {% endif %}
    
    {% if jobs %}
    <div class="results">
        <div class="results-header">
            <h2>Search Results</h2>
            <span class="results-count">{{ jobs|length }} jobs found</span>
        </div>
        
        <div class="job-list">
            {% for job in jobs %}
            <article class="job-card">
                <div class="job-header">
                    {% if job.employer_logo %}
                    <img src="{{ job.employer_logo }}" alt="{{ job.employer_name }}" class="company-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="company-logo-placeholder" style="display: none;">{{ job.employer_name[0] if job.employer_name else '?' }}</div>
                    {% else %}
                    <div class="company-logo-placeholder">{{ job.employer_name[0] if job.employer_name else '?' }}</div>
                    {% endif %}
                    <div class="job-title-section">
                        <h3><a href="{{ url_for('jobs.job_details', job_id=job.job_id) }}">{{ job.job_title }}</a></h3>
                        <p class="company-name">{{ job.employer_name }}</p>
                    </div>
                </div>
                
                <div class="job-meta">
                    <span class="meta-tag location">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                        {{ job.job_city or 'N/A' }}{% if job.job_state %}, {{ job.job_state }}{% endif %}{% if job.job_country %}, {{ job.job_country }}{% endif %}
                    </span>
                    {% if job.job_is_remote %}
                    <span class="meta-tag remote">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                        Remote
                    </span>
                    {% endif %}
                    {% if job.job_employment_type %}
                    <span class="meta-tag employment">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
                        {{ job.job_employment_type }}
                    </span>
                    {% endif %}
                    {% if job.job_min_salary or job.job_max_salary %}
                    <span class="meta-tag salary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                        {% if job.job_min_salary %}${{ "{:,.0f}".format(job.job_min_salary) }}{% endif %}
                        {% if job.job_min_salary and job.job_max_salary %} - {% endif %}
                        {% if job.job_max_salary %}${{ "{:,.0f}".format(job.job_max_salary) }}{% endif %}
                    </span>
                    {% endif %}
                </div>
                
                <p class="job-description">{{ job.job_description[:250] }}{% if job.job_description|length > 250 %}...{% endif %}</p>
                
                <div class="job-footer">
                    <span class="posted-date">
                        {% if job.job_posted_at_datetime_utc %}
                        Posted {{ job.job_posted_at_datetime_utc[:10] }}
                        {% endif %}
                    </span>
                    <div class="job-actions">
                        <a href="{{ url_for('jobs.job_details', job_id=job.job_id) }}" class="btn btn-secondary">View Details</a>
                        {% if job.job_apply_link %}
                        <a href="{{ job.job_apply_link }}" target="_blank" rel="noopener" class="btn btn-primary">Apply Now</a>
                        {% endif %}
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>
        
        <nav class="pagination">
            {% if page > 1 %}
            <a href="{{ url_for('jobs.search', query=query, location=location, page=page-1, date_posted=date_posted, remote_only=remote_only, employment_type=employment_type) }}" class="btn btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>
                Previous
            </a>
            {% endif %}
            <span class="page-info">Page {{ page }}</span>
            {% if jobs|length >= 10 %}
            <a href="{{ url_for('jobs.search', query=query, location=location, page=page+1, date_posted=date_posted, remote_only=remote_only, employment_type=employment_type) }}" class="btn btn-secondary">
                Next
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>
            </a>
            {% endif %}
        </nav>
    </div>
    {% elif query and not error %}
    <div class="no-results">
        <div class="no-results-icon">üîç</div>
        <h3>No jobs found</h3>
        <p>We couldn't find any jobs matching "{{ query }}". Try different keywords or filters.</p>
        <a href="{{ url_for('jobs.search') }}" class="btn btn-primary">Clear Search</a>
    </div>
    {% endif %}
</section>
{% endblock %}
